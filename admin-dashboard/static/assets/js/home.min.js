const homeUserStatusPagLimit=200;let homeUserStatusPagToken=0;$.ajaxSetup({headers:{"Content-Type":"application/json",Accept:"application/json"}});function populateHealthSummaryTable(email=null,getall=false){let data={pagination_token:homeUserStatusPagToken,limit:getall?1e4:homeUserStatusPagLimit};if(email!=null){data["email"]=email.escapeQuotes()}$.post("/api/paginate-user-summary-items",JSON.stringify(data),function(){console.log("Update home status summaries request response received")},"json").done(function(data){if(data["statuses"].length===0){alert("No more data!");return}homeUserStatusPagToken=data["pagination_token"];data["statuses"].forEach(function(e){let escapedEmail=e.email.escapeQuotes();let rows=[`<a href='/user/${escapedEmail}'>${escapedEmail}</a>`,"<span class='badge badge-dot mr-4'><i class='bg-"+e.health.color+"'></i><span class='status'>"+`<a class='modal-link' onclick='showHealthChangeModal("${escapedEmail}")'>`+truncate(e.health.criteria.join(" & "),45)+"</a></span></span>","<span class='badge badge-dot mr-4'><i class='bg-"+e.location.color+"'></i><span class='status'>"+`<a class='modal-link' onclick='showLocationChangeModal("${escapedEmail}")'>`+e.location.location.capitalize()+"</a></span></span>"];$("#summaries").append("<tr><td>"+rows.join("</td><td>")+"</td>")})}).fail(requestFailure)}function showHealthChangeModal(email){$("#health-user-email").html(email.escapeQuotes());$("#submitHealthModification").attr("onclick",`submitHealthModification("${email.escapeQuotes()}", false)`);$("#setHealthy").attr("onclick",`submitHealthModification("${email.escapeQuotes()}", true)`);$("#toggleVaccine").attr("onclick",`toggleVaccineModal("${email.escapeQuotes()}")`);$("#health-change").modal("show")}function showVaccinationOptionModal(email){$("health-change").modal("hide");$("#vac-user-email").html(email.escapeQuotes());$("#submitVaccineToggle").attr("onclick",`submitVaccineToggle("${email.escapeQuotes()}")`);$("#vaccine-options").modal("show")}async function submitVaccineOptionForm(email){const vax_status=$("input[name='vax-status']:checked").val();if(vax_status==null){alert("You must select an option to submit!");return}$("#submitVaccineToggle").prop("disabled",true);let data={status:vax_status,email:email.renderQuotes()};$.post("/health/modify-vaccination",JSON.stringify(data),function(){console.log("Vaccination change completed")},"json").done(async function(data){$("#submitVaccineToggle").html("Success");await sleep(500);$("#vaccine-options").modal("hide");$("#submitVaccineToggle").prop("disabled",false);$("#submitVaccineToggle").html("Submit");window.location.reload()}).fail(requestFailure)}function showLocationChangeModal(email){$("#loc-user-email").html(email.escapeQuotes());$("#submitLocationChange").attr("onclick",`submitLocationChange("${email.escapeQuotes()}")`);$("#location-change").modal("show")}async function submitHealthReportForm(email,set_healthy){let payload={};if(!set_healthy){const num_symptoms=$("#num_symptoms").val();const commercial=$("input[name='commercial']:checked").val();const proximity=$("input[name='proximity']:checked").val();if(num_symptoms==null||commercial==null||proximity==null){alert("You must complete all options to submit!");return}let parsed_num_symptoms=parseInt(num_symptoms);if(parsed_num_symptoms<0||parsed_num_symptoms>12){alert("Number of symptoms must be greater than 0 and less than 12");return}payload={num_symptoms:parsed_num_symptoms,commercial_flight:JSON.parse(commercial.toLowerCase()),proximity:JSON.parse(proximity.toLowerCase())}}else{payload={num_symptoms:0,commercial_flight:false,proximity:false}}payload["email"]=email.renderQuotes();$("#submitHealthModification").prop("disabled",true);$("#setHealthy").prop("disabled",true);$.post("/health/modify-health",JSON.stringify(payload),function(){console.log("Modify health completed")},"json").done(async function(data){$("#submitHealthModification").html("Success");await sleep(500);$("#health-change").modal("hide");$("#submitHealthModification").prop("disabled",false);$("#setHealthy").prop("disabled",false);$("#submitHealthModification").html("submit");window.location.reload()})}async function submitLocationChangeForm(email){const location=$("input[name='location']:checked").val();if(location==null){alert("You must select an option to submit!");return}$("#submitLocationChange").prop("disabled",true);let data={location:location,email:email.renderQuotes()};$.post("/health/queue-location-change",JSON.stringify(data),function(){console.log("Location change completed")},"json").done(async function(data){$("#submitLocationChange").html("Success");await sleep(500);$("#location-change").modal("hide");$("#submitLocationChange").prop("disabled",false);$("#submitLocationChange").html("Submit");window.location.reload()}).fail(requestFailure)}function submitHealthSearch(){homeUserStatusPagToken=0;const email=$("#email-input").val();$("#summaries").html("");updateHomeStatusSummaries(email);$("#load-more-home").attr("onclick",`populateMemberStatusSummaries("${email.escapeQuotes()}")`);$("#search-toggle").html("<br><button class='btn btn-secondary' onclick='clearHealthSearch()'>Clear Search</button>")}function clearHealthSearch(){homeUserStatusPagToken=0;$("#email-input").val("");$("#summaries").html("");updateHomeStatusSummaries();$("#search-toggle").html("");$("#load-more-home").attr("onclick","updateHomeStatusSummaries()")}function updateSubmittedReportsWidget(){$.post("/api/submitted-symptom-reports",JSON.stringify({}),function(){console.log("Update submitted symptom reports received")},"json").done(function(data){$("#submitted-symptom-reports").html(data.value)}).fail(requestFailure)}